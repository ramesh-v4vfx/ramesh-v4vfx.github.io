<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Productivity Stopwatch</title>

<style>
body {
  margin: 0;
  min-height: 100vh;
  min-height: 100dvh;
  background: #110000;
  font-family: system-ui, sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  color: #fff;
}

/* FIREWORKS */
#fireworks {
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
}

.app {
   width: 100%;
  max-width: 360px;
  background: #1e1e2f;
  padding: 24px;
  border-radius: 18px;
  text-align: center;
  position: relative;
  z-index: 1;
}

h2 {
  margin: 0 0 10px;
}

#display {
  font-size: 42px;
  margin: 16px 0 20px;
}

/* BUTTON GROUPS */
.buttons,
.extra {
  display: flex;
  gap: 10px;
  justify-content: center;
  margin-bottom: 12px;
}

button {
  flex: 1;
  padding: 12px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  background: #6a5acd;
  color: #fff;
  font-size: 14px;
}

button:hover { opacity: 0.9; }

.hidden { display: none !important; }

/* HISTORY PANEL */
#historyPanel {
  margin-top: 15px;
  background: #141422;
  border-radius: 12px;
  padding: 12px;
  font-size: 13px;
}

#historyHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

#historyList {
  max-height: 150px;
  overflow-y: auto;
  padding-left: 0;
  list-style: none;
  -webkit-overflow-scrolling: touch;
}

#historyList li {
  margin-bottom: 10px;
  padding-bottom: 8px;
  border-bottom: 1px solid #333;
}

/* SMALL CLEAR BUTTON */
.clear-btn {
  padding: 6px 10px;
  font-size: 12px;
  background: #3a3a55;
  border-radius: 8px;
  flex: none;
}

/* POPUP */
.popup {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.75);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 3;
}

.popup-box {
  background: #222;
  padding: 20px;
  width: 300px;
  border-radius: 14px;
}

textarea {
  width: 100%;
  height: 70px;
  margin-top: 10px;
  resize: none;
}

button {
  transition: transform 0.12s ease, box-shadow 0.12s ease, opacity 0.12s;
  box-shadow: 0 4px 10px rgba(0,0,0,0.35);
}

/* press effect */
button:active {
  transform: scale(0.95);
  box-shadow: 0 2px 5px rgba(0,0,0,0.4);
}

/* small buttons too */
.clear-btn:active {
  transform: scale(0.92);
}

* {
  -webkit-tap-highlight-color: transparent;
}

@media (max-width: 480px) {
  body {
    padding: 16px;
    align-items: stretch;
    justify-content: center; /* ðŸ‘ˆ THIS WAS MISSING */
  }

  .app {
    width: 100%;
    max-width: none;
    margin-top: 16px;
    border-radius: 18px;
    padding: 26px;
    box-shadow: none; /* removes floating-card illusion */
    min-height: auto; /* ðŸ‘ˆ THIS */
  }

   h2 {
    margin-top: 24px;
  }

  #display {
    font-size: 3.2rem;
  }
}




</style>
</head>

<body>

<canvas id="fireworks"></canvas>

<div class="app">
  <h2>STOPWATCH</h2>
  <div id="display">00:00:00</div>

  <div class="buttons">
    <button id="start">Start</button>
    <button id="pause">Pause</button>
    <button id="reset">Reset</button>
  </div>

  <div class="extra">
    <button id="historyBtn">Show History</button>
    <button id="todayBtn">Today</button>
  </div>

  <div id="historyPanel" class="hidden">
    <div id="historyHeader">
      <strong>Session History</strong>
      <button id="clearHistory" class="clear-btn">Clear</button>
    </div>
    <ul id="historyList"></ul>
  </div>
</div>

<!-- POPUP -->
<div id="popup" class="popup hidden">
  <div class="popup-box">
    <h3>What did you do?</h3>
    <textarea id="commentInput" placeholder="Write here..."></textarea>
    <div class="buttons">
      <button id="saveSession">Save</button>
      <button id="cancelSession">Cancel</button>
    </div>
  </div>
</div>

<script>
/* =====================
   UTILITIES
===================== */

function formatTime(ms) {
  const m = Math.floor(ms / 60000);
  const s = Math.floor(ms / 1000) % 60;
  const cs = Math.floor((ms % 1000) / 10);
  return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}:${String(cs).padStart(2,"0")}`;
}

function formatDurationHM(ms) {
  const totalMinutes = Math.floor(ms / 60000);
  const hours = Math.floor(totalMinutes / 60);
  const minutes = totalMinutes % 60;
  return hours > 0 ? `${hours} hr ${minutes} min` : `${minutes} min`;
}

/* =====================
   STOPWATCH
===================== */

let startTime = 0;
let elapsed = 0;
let timer = null;
let sessionStartISO = null;

const display = document.getElementById("display");

function updateDisplay() {
  display.textContent = formatTime(elapsed);
}

/* =====================
   STORAGE
===================== */

let sessions = JSON.parse(localStorage.getItem("sessions")) || [];

function saveSessions() {
  localStorage.setItem("sessions", JSON.stringify(sessions));
}

/* =====================
   BUTTONS
===================== */

start.onclick = () => {
  if (timer) return;
  if (!sessionStartISO) sessionStartISO = new Date().toISOString();

  startTime = Date.now() - elapsed;
  timer = setInterval(() => {
    elapsed = Date.now() - startTime;
    updateDisplay();
  }, 10);
};

pause.onclick = () => {
  clearInterval(timer);
  timer = null;
};

reset.onclick = () => {
  if (!elapsed) return;
  popup.classList.remove("hidden");
  commentInput.focus();
};

/* =====================
   SAVE SESSION
===================== */

saveSession.onclick = () => {
  const end = new Date();

  sessions.unshift({
    ms: elapsed,
    time: formatTime(elapsed),
    comment: commentInput.value || "No comment",
    startISO: sessionStartISO,
    endISO: end.toISOString(),
    day: end.toISOString().slice(0,10)
  });

  saveSessions();
  popup.classList.add("hidden");
  commentInput.value = "";

  runFireworks(); // ðŸŽ† celebration

  elapsed = 0;
  sessionStartISO = null;
  clearInterval(timer);
  timer = null;
  updateDisplay();
};

cancelSession.onclick = () => popup.classList.add("hidden");

/* =====================
   HISTORY
===================== */

historyBtn.onclick = () => {
  const isHidden = historyPanel.classList.toggle("hidden");
  historyBtn.textContent = isHidden ? "Show History" : "Hide History";
  if (!isHidden) renderHistory();
};

function renderHistory() {
  historyList.innerHTML = "";
  sessions.forEach(s => {
    const from = new Date(s.startISO).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    const to = new Date(s.endISO).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});

    historyList.innerHTML += `
      <li>
        <strong>${from} â†’ ${to}</strong><br>
        ${s.comment}<br>
        <small>Duration: ${formatDurationHM(s.ms)}</small>
      </li>`;
  });
}

clearHistory.onclick = () => {
  if (!confirm("Clear all history?")) return;
  sessions = [];
  saveSessions();
  historyList.innerHTML = "";
};

/* =====================
   TODAY PRODUCTIVITY
===================== */

todayBtn.onclick = () => {
  const today = new Date().toISOString().slice(0,10);
  const todaySessions = sessions.filter(s => s.day === today);

  if (!todaySessions.length) {
    alert("No sessions today.");
    return;
  }

  let total = 0;
  let msg = "Today:\n\n";

  todaySessions.forEach(s => {
    total += s.ms;
    msg += `â€¢ ${s.comment} (${formatDurationHM(s.ms)})\n`;
  });

  msg += `\nTotal: ${formatDurationHM(total)}`;
  alert(msg);
};

document.querySelectorAll("button").forEach(btn => {
  btn.addEventListener("touchstart", () => {
    btn.style.transform = "scale(0.95)";
  });
  btn.addEventListener("touchend", () => {
    btn.style.transform = "";
  });
});


/* =====================
   FIREWORKS ðŸŽ†
===================== */

const fwCanvas = document.getElementById("fireworks");
const fwCtx = fwCanvas.getContext("2d");

function resizeFW() {
  fwCanvas.width = innerWidth;
  fwCanvas.height = innerHeight;
}
resizeFW();
addEventListener("resize", resizeFW);

let fireworks = [];

function runFireworks(duration = 2500) {
  const start = Date.now();

  function loop() {
    fwCtx.clearRect(0,0,fwCanvas.width,fwCanvas.height);

    if (Math.random() < 0.2) {
      const x = Math.random() * fwCanvas.width;
      const y = Math.random() * fwCanvas.height * 0.5;
      for (let i = 0; i < 40; i++) {
        fireworks.push({
          x, y,
          vx: (Math.random() - 0.5) * 6,
          vy: (Math.random() - 0.5) * 6,
          life: 60,
          color: `hsl(${Math.random()*360},100%,60%)`
        });
      }
    }

    fireworks.forEach(p => {
      p.x += p.vx;
      p.y += p.vy;
      p.vy += 0.05;
      p.life--;
      fwCtx.fillStyle = p.color;
      fwCtx.globalAlpha = p.life / 60;
      fwCtx.beginPath();
      fwCtx.arc(p.x, p.y, 2, 0, Math.PI * 2);
      fwCtx.fill();
    });

    fireworks = fireworks.filter(p => p.life > 0);
    fwCtx.globalAlpha = 1;

    if (Date.now() - start < duration) requestAnimationFrame(loop);
    else fwCtx.clearRect(0,0,fwCanvas.width,fwCanvas.height);
  }

  loop();
}

updateDisplay();
</script>

</body>
</html>
